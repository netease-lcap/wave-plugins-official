# SDD 插件

**Software Design & Documentation** - 软件设计与文档工具集

从现有代码生成功能规格说明文档，帮助你理解和记录代码功能模块。

## 概述

SDD 插件通过阅读现有代码来生成结构化的功能规格说明文档。它帮助团队：
- 理解现有代码的功能和架构
- 为缺少文档的代码创建规格说明
- 在维护或重构前记录当前实现
- 为新团队成员提供清晰的功能描述

## 命令

### `/code2spec`

从现有代码生成功能规格说明文档。

**它的功能：**
1. 接收功能模块描述（可选提供代码路径）
2. 自动探索或直接阅读相关代码
3. 分析功能的用户场景和需求
4. 生成结构化的规格说明文档
5. 创建质量检查清单
6. 为不明确的部分提供澄清选项

**用法：**
```bash
/code2spec [功能模块描述] [可选：代码路径]
```

**示例工作流：**
```bash
# 方式 1: 提供功能描述，让 AI 自动查找代码
/code2spec 用户认证模块

# 方式 2: 提供功能描述和具体代码路径
/code2spec 用户认证模块 src/auth

# AI 会：
# - 确认或探索要分析的代码
# - 阅读相关代码文件
# - 分析用户流程、数据结构和关键功能
# - 生成规格说明文档
# - 创建质量检查清单
# - 如有需要，询问澄清问题
```

**重要提示：**
- **这是从代码生成规格的命令**：不是根据需求凭空创建，而是分析现有代码
- **功能描述是必需的**：如"用户认证"、"支付处理"
- **代码路径是可选的**：
  - ✅ 提供路径：`/code2spec 用户认证 src/auth`（更快速）
  - ✅ 不提供路径：`/code2spec 用户认证`（AI 会自动查找）
  
**功能特点：**
- 自动创建 Git 分支和目录结构
- 使用标准化的规格说明模板（中文）
- 生成质量检查清单确保完整性
- 最多 3 个澄清问题（仅针对关键决策）
- 文档记录假设和推断
- 跨平台支持（Windows、Linux、macOS）

## 生成的内容

运行 `/code2spec` 后，插件会生成：

### 1. 规格说明文档 (`spec.md`)
包含以下部分：
- **用户场景与测试**：按优先级排序的用户故事
- **需求**：功能需求和关键实体
- **假设**：记录的合理假设
- **依赖**：外部依赖关系
- **范围外**：明确不包含的内容

### 2. 质量检查清单 (`checklists/requirements.md`)
验证项包括：
- 内容质量（无实现细节、面向业务）
- 需求完整性（可测试、明确）
- 功能就绪性（验收标准、用户场景覆盖）

### 3. Git 分支
- 自动创建功能分支（例如：`001-用户认证`）
- 分支名称基于功能描述自动生成

## 目录结构

```
specs/
└── 001-用户认证/
    ├── spec.md                      # 功能规格说明
    └── checklists/
        └── requirements.md          # 质量检查清单
```

## 工作流程集成

### 典型工作流：

1. **识别需要文档的模块**
   ```bash
   # 查看代码结构
   ls src/
   ```

2. **生成规格说明**
   ```bash
   /code2spec 支付处理模块 src/payment
   ```

3. **审查和完善**
   - AI 会阅读代码并生成初始规格说明
   - 如有不明确的地方，会提供选项供你选择
   - 审查生成的文档并根据需要调整

4. **使用规格说明**
   - 作为重构的参考
   - 用于团队培训
   - 作为进一步开发的基础

### 与其他工具配合：

```bash
# 生成规格说明
/code2spec API 路由模块 src/routes

# 审查后提交文档
/commit

# 继续开发或重构
# 规格说明文档已经记录了现有功能
```

## 脚本和模板

插件包含以下文件：

### `scripts/create-new-feature.py`
Python 脚本，用于：
- 创建功能目录结构
- 生成分支名称
- 创建 Git 分支
- 初始化规格说明文件

**独立使用：**
```bash
# 基本用法
python scripts/create-new-feature.py "功能描述"

# JSON 输出
python scripts/create-new-feature.py --json "功能描述"

# 自定义简短名称
python scripts/create-new-feature.py --short-name "自定义名" "功能描述"
```

### `templates/spec-template.md`
中文版规格说明模板，包含：
- 结构化的部分和占位符
- 详细的注释和说明
- 优先级指导
- 验收场景示例

## 安装

此插件包含在 Wave 官方插件仓库中。

### 启用插件：

1. 确保插件目录在 Wave 配置中
2. 插件会自动加载
3. `/code2spec` 命令立即可用

## 最佳实践

### 使用 `/code2spec` 的技巧：

1. **提供清晰的功能描述**
   - 使用具体的模块名称（如："用户认证"、"支付处理"）
   - 如果知道代码位置，可以一并提供（更高效）
   - 让 AI 探索时，确保功能名称有足够的特征性

2. **合理的模块大小**
   - 不要一次性分析整个代码库
   - 专注于单一功能或模块
   - 复杂功能可以分多次生成

3. **审查生成的内容**
   - 检查用户故事是否准确
   - 验证功能需求是否完整
   - 确认假设是否合理

4. **回答澄清问题**
   - 仔细阅读每个问题的上下文
   - 选择最符合实际的选项
   - 必要时提供自定义答案

### 何时使用此插件：

- ✅ 代码缺少文档但需要维护
- ✅ 新团队成员需要了解现有功能
- ✅ 准备重构或重写功能
- ✅ 需要向非技术人员解释功能
- ✅ 创建测试计划前需要规格说明

### 何时不使用：

- ❌ 代码还在快速变化中
- ❌ 功能过于简单（几行代码）
- ❌ 已有完整的文档

## 配置

### 自定义模板

你可以在项目根目录创建自己的模板：

```bash
.specify/
└── templates/
    └── spec-template.md    # 自定义模板
```

插件会优先使用项目根目录的模板。

### 环境变量

脚本会设置 `SPECIFY_FEATURE` 环境变量，包含当前功能分支名称。

## 需求

- Python 3.6+ （用于运行脚本）
- Git（可选，用于分支管理）
- Wave Agent SDK

## 故障排除

### 脚本无法运行

**问题**：`python: command not found`

**解决方案**：
- 确保安装了 Python 3.6+
- Windows: 使用 `python` 或 `py`
- Linux/macOS: 使用 `python3`

### AI 没有找到正确的代码

**问题**：AI 找到的代码不是你想要的

**解决方案**：
- 直接提供代码路径：`/code2spec 用户认证 src/auth`
- 使用更具体的功能描述
- 确认代码库中确实存在该功能模块

### 生成的规格说明不准确

**问题**：规格说明与实际功能不符

**解决方案**：
- 检查 AI 分析的代码范围是否正确
- 审查并手动编辑生成的 `spec.md`
- 回答澄清问题以提供更多上下文

### Git 分支未创建

**问题**：没有创建 Git 分支

**解决方案**：
- 确保在 Git 仓库中运行
- 检查是否有权限创建分支
- 插件会在没有 Git 时继续工作，只是不创建分支

## 提示

- **从小模块开始**：先为简单模块生成文档，熟悉流程
- **迭代完善**：生成后可以手动编辑和完善文档
- **结合代码审查**：在代码审查时使用规格说明作为参考
- **定期更新**：代码变化后更新规格说明文档
- **团队协作**：与团队分享生成的文档并收集反馈

## 技术细节

### 规格说明原则

生成的规格说明遵循以下原则：
- **关注"是什么"和"为什么"**，而不是"如何"
- **面向业务和用户**，而不是技术实现
- **可测试和明确**的需求
- **记录假设**而不是留下模糊
- **优先级明确**的用户故事

### 质量保证

插件包含多层质量检查：
1. 模板结构确保完整性
2. 质量检查清单验证标准
3. 澄清流程处理不确定性
4. 最多 3 次验证迭代

## 未来扩展

SDD (Software Design & Documentation) 插件设计为可扩展的工具集：
- 当前功能：从代码生成规格说明 (`/code2spec`)
- 未来可能添加：
  - 架构图生成
  - API 文档生成
  - 测试用例生成
  - 设计决策记录 (ADR)
  - 等等...

## 版本

1.0.0

## 许可证

与 Wave Plugins Official 仓库相同

## 贡献

欢迎贡献！请参考主仓库的贡献指南。

## 反馈

如有问题或建议，请在仓库中创建 issue。
